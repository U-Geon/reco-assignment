## [ADR] OCR 노이즈 및 비정형 데이터 파싱 전략

### 1. 배경 및 문제점
계근지 OCR 결과는 스캔 상태나 문서 양식에 따라 다양한 노이즈가 발생합니다.

- **인터리빙 노이즈:** `총중량 : 11시 33분 14,080 kg` 처럼 라벨과 값 사이에 시각 정보나 잡음이 끼어드는 현상.
- **OCR Typos:** 숫자 `0`이 `O`로, `5`가 `S`로 인식되는 등 오인식 빈번.
- **비정형 텍스트:** 업체명이나 품목명은 정해진 패턴(숫자, 날짜 등)이 없어 정규식만으로는 추출이 어려움.


### 2. 대안 분석

OCR 결과에 대한 에러들을 해결하기 위해 AI를 활용하여 여러 가지 대안들을 분석해봤습니다. 

1.  **단순 문자열 처리 (Split/Slicing)**
    - 구현이 쉽지만, 노이즈가 조금만 섞여도 파싱이 실패함. 확장성이 매우 낮음.
2.  **LLM (Large Language Model) 활용**
    - 정확도는 높으나 비용이 비싸고 응답 속도가 느림. OCR 간단한 파싱 작업에는 오버엔지니어링일 수 있음.
3.  **Regex + NLP**
    - 패턴이 있는 데이터는 우선 정규 표현식을 활용하고, 비정형 데이터는 요구사항에 명시되어있는 spaCy로 처리.


### 3. Decision (결정)

따라서, 비용적인 측면이나 정확성 측면을 고려하여 Hybrid 방식을 채택했습니다.

- **정규표현식 적용:** 중량, 날짜 등 패턴이 명확한 데이터 추출에 사용. 특히 `.*?` 패턴을 활용하여 라벨과 값 사이의 가변적인 노이즈를 건너뛰도록 설계.
- **spaCy NER 적용:** 업체명 추출을 위해 한국어 모델(`ko_core_news_sm`)을 도입하여 **기관, 품명** 등 비정형 레이블 인식.
- **Heuristic 로직 적용:** `입/출고 시간(가장 이른/늦은 시간)` 및 `중량 보정(총중량-공차=실중량)` 로직 적용.


### 4. Consequences (결과)
- **장점:** 대부분의 노이즈 상황에서도 핵심 데이터를 안정적으로 추출할 수 있게 됨. 외부 API 호출 없이 로컬에서 빠르게 동작함.
- **단점:** spaCy 모델 로딩으로 인한 초기 구동 시간 및 메모리 사용량 약간 증가.
