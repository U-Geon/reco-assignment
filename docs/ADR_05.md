# [ADR] 다양한 계근지 양식 대응을 위한 파싱 로직 유연화

## 1. Context (배경 및 문제점)
초기 파싱 로직은 특정 양식(`sample_03.json`)에 최적화되어 있어, 다른 형태의 계근지(`sample_01`, `02`, `04`)를 처리하는 데 한계가 있었습니다.

1.  **라벨 불일치:** `총중량` 대신 `총`, `공차중량` 대신 `차중량` 등의 용어 사용.
2.  **숫자 포맷 변형:** 천단위 구분기호(`,`) 대신 공백(` `)을 사용하거나(`13 460`), 아예 구분 기호가 없는 경우.
3.  **시간 포맷 변형:** `HH:MM` 형식에서 콜론 사이 공백(`02 : 13`)이 존재하거나, 시간 정보가 중량 값 뒤에 위치(`14,230 kg (09:09)`)하는 경우.
4.  **라벨 누락:** `총중량` 등의 라벨 없이 숫자와 단위만 표기된 경우 파싱 실패.


## 2. Alternatives (고려한 대안들)

1.  **양식별 템플릿 매칭:**
    - 각 계근지 양식마다 별도의 파서(Parser)를 구현하고, 문서 특징에 따라 분기 처리.
    - 구현 비용이 높고, 새로운 양식이 나올 때마다 코드를 수정해야 함.
2.  **범용 파싱 로직 강화 (Rule-based + Heuristic):**
    - 기존 로직을 확장하여 다양한 변형을 수용하고, 라벨을 찾지 못할 경우를 대비한 Fallback 로직 추가.


## 3. Decision (결정)

**범용 파싱 로직 강화** 방식을 선택했습니다.
유지보수성을 해치지 않으면서 파싱 성공률을 높이기 위해 다음과 같은 전략을 적용했습니다.

### 3.1. 키워드 및 패턴 확장

- **라벨 확장:** `총`, `총량`, `차중량`, `차량중량`, `실량`, `순중량`, `거래처` 등 동의어 리스트를 대폭 추가했습니다.
- **숫자 패턴:** 정규표현식에서 공백(` `)을 허용하고, 파싱 단계에서 이를 제거하여 `13 460` -> `13460`으로 변환하도록 개선했습니다.
- **시간 패턴:** `\s*:\s*` 패턴을 사용하여 `02 : 13`과 같은 공백 포함 시간 형식을 지원했습니다.


### 3.2. Fallback 로직 (위치 기반 추론)
라벨 기반 추출이 실패할 경우를 대비해 **Fallback 로직**을 도입했습니다.

1.  문서 내에서 `kg` 단위가 붙은 모든 숫자(무게 후보)를 추출합니다.
2.  추출된 숫자들을 내림차순으로 정렬합니다.
3.  계근지의 일반적인 특성상 **총중량 > 공차중량 > 실중량** 순서임을 이용하여, 큰 값부터 순차적으로 할당합니다.


## 4. Consequences (결과)

- **장점:**
    - 라벨이 없거나 오타가 심한 경우, 혹은 양식이 비표준적인 경우에도 높은 확률로 중량 데이터를 추출할 수 있게 되었습니다.
    - 하나의 파서로 다양한 양식을 처리할 수 있어 코드 중복을 최소화했습니다.
- **단점:**
    - Fallback 로직은 "가장 큰 값이 총중량"이라는 가정에 의존하므로, 문서에 무게와 무관한 큰 숫자(예: 일련번호 등인데 kg 단위로 오인식된 경우)가 있을 경우 오탐 가능성이 존재합니다. (하지만 `kg` 단위 앵커로 인해 확률은 낮음)
